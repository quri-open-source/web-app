<div class="project-preview-container">
  @if (loading) {
    <div class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>{{ 'design.loading_project_preview' | translate }}</p>
    </div>
  } @else if (error) {
    <div class="error-container">
      <mat-icon>error</mat-icon>
      <h2>{{ 'common.error' | translate }}</h2>
      <p>{{ error | translate }}</p>
      <button mat-raised-button color="primary" routerLink="/design-lab">
        {{ 'design.go_back' | translate }}
      </button>
    </div>
  } @else if (project) {
    <div class="project-header">
      <h1>{{ project.title }}</h1>
      <div class="project-meta">
        <mat-chip-listbox>
          <mat-chip>{{ project.status | titlecase }}</mat-chip>
          <mat-chip>{{ ('design.' + project.garmentGender) | translate | titlecase }}</mat-chip>
          <mat-chip>{{ 'design.size' | translate }}: {{ project.garmentSize }}</mat-chip>
        </mat-chip-listbox>
      </div>
    </div>    <div class="project-content">
      <div class="project-preview-area">
        <div class="canvas-container">
          @if (project.previewUrl) {
            <img [src]="project.previewUrl" [alt]="project.title" class="preview-image" />
          } @else {
            <div class="canvas-placeholder">
              <div class="tshirt-preview">
                <div class="tshirt-container">
                  <div class="tshirt-image">
                    <div
                      class="garment-color"
                      [style.background-color]="project.garmentColor"
                    >
                      <!-- Preview layers if available -->
                      @if (project.layers && project.layers.length > 0) {
                        @for (layer of project.layers; track layer.id) {
                          @if (layer.type === 'text') {
                            <div
                              class="text-layer-preview"
                              [style.left.px]="layer.x"
                              [style.top.px]="layer.y"
                              [style.z-index]="layer.z"
                              [innerHTML]="layer.getContent()"
                            ></div>
                          } @else if (layer.type === 'image') {
                            <img
                              class="image-layer-preview"
                              [src]="layer.getContent()"
                              [style.left.px]="layer.x"
                              [style.top.px]="layer.y"
                              [style.z-index]="layer.z"
                            />
                          }
                        }
                      } @else {
                        <div class="no-design">
                          <mat-icon>design_services</mat-icon>
                          <span>No design elements added yet</span>
                        </div>
                      }
                    </div>
                  </div>
                </div>
              </div>
            </div>
          }
        </div>
      </div>

      <div class="project-details">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Project Details</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="detail-row">
              <strong>Status:</strong> {{ project.status | titlecase }}
            </div>
            <div class="detail-row">
              <strong>Gender:</strong> {{ project.garmentGender| titlecase }}
            </div>
            <div class="detail-row">
              <strong>Garment Color:</strong>
              <span class="color-indicator" [style.background-color]="project.garmentColor"></span>
              {{ project.garmentColor }}
            </div>
            <div class="detail-row">
              <strong>Size:</strong> {{ project.garmentSize }}
            </div>
            <div class="detail-row">
              <strong>Created:</strong> {{ project.createdAt | date:'medium' }}
            </div>
            <div class="detail-row">
              <strong>Last Modified:</strong> {{ project.updatedAt | date:'medium' }}
            </div>
          </mat-card-content>
        </mat-card>

        @if (project.layers && project.layers.length > 0) {
          <mat-card>
            <mat-card-header>
              <mat-card-title>Layers ({{ project.layers.length }})</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              @for (layer of project.layers; track layer.id) {
                <div class="layer-item">
                  <mat-icon>{{ layer.type === 'image' ? 'image' : 'text_fields' }}</mat-icon>
                  <span>{{ ('design.' + layer.type) | translate | titlecase }} {{ 'design.layer' | translate }}</span>
                  @if (layer.type === 'text') {
                    <span class="layer-content">- "{{ layer.getContent() }}"</span>
                  }
                </div>
              }
            </mat-card-content>
          </mat-card>
        }
      </div>
    </div>    <div class="action-buttons">
      <button mat-raised-button color="primary" [routerLink]="['/design-lab', project.id, 'edit']">
        <mat-icon>edit</mat-icon>
        {{ 'design.edit_this_project' | translate }}
      </button>
      <button mat-stroked-button routerLink="/design-lab">
        <mat-icon>arrow_back</mat-icon>
        {{ 'design.go_back' | translate }}
      </button>
    </div>
  }
</div>
